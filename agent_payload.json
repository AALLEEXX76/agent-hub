{"task":"Ты — ИИ-агент по инфраструктуре. Твоя задача — САМОСТОЯТЕЛЬНО собрать в n8n пульт управления сервером через Telegram,\nиспользуя REST API n8n и SSH-шлюз /usr/local/sbin/iibot.\n\nТы получаешь JSON (payload) с этим заданием и параметрами:\n- payload.task              — текст задачи (то, что ты сейчас читаешь)\n- payload.n8n.baseUrl       — базовый URL n8n\n- payload.n8n.apiKey        — API-ключ (заголовок X-N8N-API-KEY)\n- payload.server            — IP и домен сервера\n- payload.telegram.allowedAdmins — список Telegram ID админов.\n\n[ n8n ]\n- baseUrl: https://ii-bot-nout.ru\n- apiKey: уже есть в payload.n8n.apiKey\n\n[ сервер ]\n- ip: 92.51.21.146\n- domain: ii-bot-nout.ru\n\n[ SSH-шлюз ]\nНа сервере есть пользователь \"agent\" с ограниченным sudo.\nДля него настроен шлюз /usr/local/sbin/iibot.\n\nРежим: sudo /usr/local/sbin/iibot <action>\n\nРазрешённые действия:\n- docker_status  → показать статус контейнеров (docker ps + docker compose ps)\n- healthz        → curl https://ii-bot-nout.ru/healthz\n- backup_now     → pg_dump БД n8n в /opt/n8n/backups\n- restart_n8n    → docker compose restart n8n\n- caddy_logs     → journalctl -u caddy -n 120\n\n[ Требуемый workflow ]\n\nСоздай или обнови workflow в n8n:\n  \"II-BOT Executor v1 (Telegram → SSH)\"\n\nТребования к логике:\n\n1) Telegram Trigger\n   - принимает сообщения только от админов:\n     Telegram ID: 535520922, 951230951\n   - использует существующий Telegram credential бота.\n\n2) Парсер команд\n   - из текста определяет action:\n     docker_status, healthz, backup_now, restart_n8n, caddy_logs.\n\n3) Контроль доступа\n   - если отправитель не из admin IDs → ответ:\n     \"⛔️ Нет доступа. Этот бот принимает команды только от админов.\"\n\n4) Неизвестные команды\n   - если action = unknown → отправить список доступных команд.\n\n5) Опасная команда restart_n8n\n   - сначала сообщение-предупреждение с инструкцией подтвердить\n     \"/confirm RESTART_N8N\"\n   - выполнять restart_n8n только после такой команды от того же admin ID.\n\n6) SSH-выполнение\n   - использовать существующий SSH credential пользователя agent\n   - команда:\n       sudo /usr/local/sbin/iibot {{$json.action}}\n   - stdout/stderr обрезать до ~3800 символов и отправлять в Telegram.\n\n7) Работать только через REST API n8n:\n   - /api/v1/credentials — найти нужные Telegram и SSH credentials\n   - /api/v1/workflows   — создать или обновить workflow\n   - /api/v1/workflows/:id/activate — активировать workflow\n\nВ ответ на это задание верни:\n- JSON workflow для n8n\n- список HTTP-запросов, которые ты выполнишь\n- краткую инструкцию по тесту:\n/status, /backup, /restart + /confirm RESTART_N8N.","n8n":{"baseUrl":"https://ii-bot-nout.ru","apiKey":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyNzdhMjQ2OC0zOTIxLTQyYTYtOTgwZC0zZGU3NmM2YTQ5ZTgiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY2NzQ1NDI3fQ.IqxHocHz3qdh7HJ178BgmFf5hR3dZ2t_aaYLl72zRMk"},"server":{"ip":"92.51.21.146","domain":"ii-bot-nout.ru"},"telegram":{"allowedAdmins":[535520922,951230951]}}
